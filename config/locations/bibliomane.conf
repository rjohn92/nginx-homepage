location /bibliomane/ {
    auth_request /oauth2/auth;
    error_page 401 = @oauth2_redirect;

    include /etc/nginx/config/snippets/proxy-headers.conf;
    include /etc/nginx/config/snippets/proxy-resilience.conf;

    # Map auth_request headers into real request
    auth_request_set $user   $upstream_http_x_auth_request_user;
    auth_request_set $email  $upstream_http_x_auth_request_email;
    auth_request_set $groups $upstream_http_x_auth_request_groups;
    auth_request_set $token  $upstream_http_x_auth_request_access_token;

    proxy_set_header X-User            $user;
    proxy_set_header X-Email           $email;
    proxy_set_header X-Groups          $groups;
    proxy_set_header X-Access-Token    $token;

    # ðŸ‘‡ Strip the /bibliomane prefix
    rewrite ^/bibliomane(/.*)$ $1 break;

    proxy_pass http://bibliomane:3001;
}
